local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

-- Hàm để lấy nơi chứa GUI an toàn (hỗ trợ các executor hiện đại)
local function getUIParent()
	if gethui then
		return gethui()
	elseif CoreGui:FindFirstChild("RobloxGui") then
		return CoreGui
	else
		return Players.LocalPlayer:WaitForChild("PlayerGui")
	end
end

-- Xóa UI cũ nếu tồn tại để tránh trùng lặp
local oldGui = getUIParent():FindFirstChild("MaintenanceNotifyUI")
if oldGui then oldGui:Destroy() end

-- --- TẠO UI ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MaintenanceNotifyUI"
ScreenGui.Parent = getUIParent()
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

-- Main Container (Khung chính)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 400, 0, 180)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0) -- Giữa màn hình
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25) -- Màu đen xám hiện đại
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.BackgroundTransparency = 1 -- Bắt đầu trong suốt để làm hiệu ứng hiện ra

-- Bo tròn góc (Corner)
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- Viền mỏng (Stroke)
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(60, 60, 60)
UIStroke.Thickness = 1
UIStroke.Transparency = 1
UIStroke.Parent = MainFrame

-- Tiêu đề (Header)
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Text = "NOTICE"
Title.Size = UDim2.new(1, -40, 0, 30)
Title.Position = UDim2.new(0, 20, 0, 20)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextTransparency = 1
Title.Parent = MainFrame

-- Nội dung (Body Text)
local Description = Instance.new("TextLabel")
Description.Name = "Description"
Description.Text = "Chilli Hub will be back in the next 6-12 hours.\nThank you for your patience."
Description.Size = UDim2.new(1, -40, 0, 60)
Description.Position = UDim2.new(0, 20, 0, 60)
Description.BackgroundTransparency = 1
Description.TextColor3 = Color3.fromRGB(180, 180, 180) -- Màu xám nhạt dễ đọc
Description.Font = Enum.Font.GothamMedium
Description.TextSize = 14
Description.TextXAlignment = Enum.TextXAlignment.Left
Description.TextYAlignment = Enum.TextYAlignment.Top
Description.TextWrapped = true
Description.TextTransparency = 1
Description.Parent = MainFrame

-- Nút đóng (Close Button / X)
local CloseBtn = Instance.new("TextButton")
CloseBtn.Name = "CloseButton"
CloseBtn.Text = "×" -- Dấu nhân đẹp
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 15)
CloseBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 20
CloseBtn.AutoButtonColor = false
CloseBtn.Parent = MainFrame
CloseBtn.BackgroundTransparency = 1
CloseBtn.TextTransparency = 1

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseBtn

-- --- ANIMATION (HIỆU ỨNG) ---

-- Cấu hình Tween
local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out)

-- Hàm tạo hiệu ứng hiện ra (Pop up)
local function animateIn()
	-- Set trạng thái ban đầu
	MainFrame.Position = UDim2.new(0.5, 0, 0.55, 0) -- Thấp hơn một chút
	MainFrame.BackgroundTransparency = 1
	
	-- Tween Main Frame
	TweenService:Create(MainFrame, tweenInfo, {
		Position = UDim2.new(0.5, 0, 0.5, 0),
		BackgroundTransparency = 0.1 -- Hơi trong suốt nhẹ kiểu kính
	}):Play()
	
	TweenService:Create(UIStroke, tweenInfo, {Transparency = 0.8}):Play()
	
	-- Tween Text & Button
	task.wait(0.1)
	TweenService:Create(Title, tweenInfo, {TextTransparency = 0}):Play()
	TweenService:Create(Description, tweenInfo, {TextTransparency = 0}):Play()
	TweenService:Create(CloseBtn, tweenInfo, {BackgroundTransparency = 0, TextTransparency = 0}):Play()
end

-- Hàm tạo hiệu ứng đóng (Close)
local function closeUI()
	local closeInfo = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
	
	TweenService:Create(MainFrame, closeInfo, {
		Size = UDim2.new(0, 380, 0, 160), -- Thu nhỏ lại xíu
		BackgroundTransparency = 1
	}):Play()
	
	TweenService:Create(UIStroke, closeInfo, {Transparency = 1}):Play()
	TweenService:Create(Title, closeInfo, {TextTransparency = 1}):Play()
	TweenService:Create(Description, closeInfo, {TextTransparency = 1}):Play()
	TweenService:Create(CloseBtn, closeInfo, {BackgroundTransparency = 1, TextTransparency = 1}):Play()
	
	task.wait(0.4)
	ScreenGui:Destroy()
end

-- --- LOGIC NÚT BẤM ---

CloseBtn.MouseButton1Click:Connect(function()
	closeUI()
end)

-- Hiệu ứng Hover cho nút tắt
CloseBtn.MouseEnter:Connect(function()
	TweenService:Create(CloseBtn, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(200, 50, 50), -- Màu đỏ khi đưa chuột vào
		TextColor3 = Color3.fromRGB(255, 255, 255)
	}):Play()
end)

CloseBtn.MouseLeave:Connect(function()
	TweenService:Create(CloseBtn, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(40, 40, 40), -- Trả về màu cũ
		TextColor3 = Color3.fromRGB(200, 200, 200)
	}):Play()
end)

-- Chạy Animation mở đầu
animateIn()

-- Cho phép kéo thả bảng (Draggable)
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

MainFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		if dragging then
			update(input)
		end
	end
end)
