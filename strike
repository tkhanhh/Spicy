local MacLib = { 
	Options = {}, 
	Folder = "ChilliLib", 
	GetService = function(service)
		return cloneref and cloneref(game:GetService(service)) or game:GetService(service)
	end
}

--// Services
local TweenService = MacLib.GetService("TweenService")
local RunService = MacLib.GetService("RunService")
local UserInputService = MacLib.GetService("UserInputService")
local Players = MacLib.GetService("Players")
local CoreGui = MacLib.GetService("CoreGui")

--// Variables
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local ViewportSize = workspace.CurrentCamera.ViewportSize

--// Chilli Finder Theme Palette (Updated)
local THEME = {
    Background    = Color3.fromRGB(15, 23, 42),      -- Main dark blue BG
    Sidebar       = Color3.fromRGB(12, 18, 32),      -- Sidebar BG
    Section       = Color3.fromRGB(30, 41, 59),      -- Section BG (Blueish)
    SectionStroke = Color3.fromRGB(56, 189, 248),    -- Cyan Stroke
    Accent        = Color3.fromRGB(6, 182, 212),     -- Cyan/Teal Accent
    Text          = Color3.fromRGB(241, 245, 249),   -- White Text
    TextMuted     = Color3.fromRGB(148, 163, 184),   -- Gray Text
    Div           = Color3.fromRGB(51, 65, 85),      -- Dividers
    
    FontBold      = Enum.Font.GothamBold,
    FontSemi      = Enum.Font.GothamMedium,
    FontNormal    = Enum.Font.Gotham,
}

local IconList

--// Helper Functions
local function GetGui()
	local newGui = Instance.new("ScreenGui")
	newGui.Name = "ChilliLibUI"
	newGui.ScreenInsets = Enum.ScreenInsets.None
	newGui.ResetOnSpawn = false
	newGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	newGui.DisplayOrder = 10000

	local parent = RunService:IsStudio() 
		and LocalPlayer:FindFirstChild("PlayerGui")
		or (gethui and gethui())
		or CoreGui

	newGui.Parent = parent
	return newGui
end

local function Tween(instance, info, props)
    if not instance then return end
    local t = TweenService:Create(instance, info, props)
    t:Play()
    return t
end

-- Helper: Safe Callback Execution (Fixes the IO_SAVE crash)
local function SafeCallback(func, ...)
    if not func then return end
    local args = {...}
    task.spawn(function()
        local success, err = pcall(function()
            func(unpack(args))
        end)
        if not success then
            warn("[MacLib] Callback Error:", err)
        end
    end)
end

-- Icon Loader
local function gl(i)
	if not IconList then
		pcall(function()
			IconList = loadstring(game:HttpGet('https://raw.githubusercontent.com/Dummyrme/Library/refs/heads/main/Icon.lua'))()
		end)
	end
    
    if IconList and IconList.Icons and IconList.Icons[i] then
        local iconData = IconList.Icons[i]
        local spriteSheet = IconList.Spritesheets[tostring(iconData.Image)]
        return { Image = spriteSheet, ImageRectSize = iconData.ImageRectSize, ImageRectPosition = iconData.ImageRectPosition }
    end
    
    return { Image = "rbxassetid://" .. tostring(i):gsub("rbxassetid://", ""), ImageRectSize = Vector2.new(0,0), ImageRectPosition = Vector2.new(0,0) }
end

--// Library Functions
function MacLib:Window(Settings)
	local WindowFunctions = {Settings = Settings}
	local macLib = GetGui()
    
    --// Notification Holder (Top Right)
	local notifications = Instance.new("Frame")
	notifications.Name = "Notifications"
	notifications.BackgroundTransparency = 1
	notifications.Size = UDim2.new(0, 300, 1, -20)
    notifications.Position = UDim2.new(1, -310, 0, 30)
    notifications.AnchorPoint = Vector2.new(0, 0)
	notifications.Parent = macLib
	notifications.ZIndex = 100

	local notifLayout = Instance.new("UIListLayout")
	notifLayout.Padding = UDim.new(0, 10)
	notifLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
	notifLayout.SortOrder = Enum.SortOrder.LayoutOrder
	notifLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	notifLayout.Parent = notifications

    --// Main Window Frame (Reduced Size)
    local MainSize = Settings.Size or UDim2.fromOffset(580, 380) -- Reduced by ~15% from typical 700x450

	local base = Instance.new("CanvasGroup") -- Use CanvasGroup for smooth opacity tweening
	base.Name = "MainBase"
	base.AnchorPoint = Vector2.new(0.5, 0.5)
	base.Position = UDim2.fromScale(0.5, 0.5)
	base.Size = MainSize
    base.BackgroundColor3 = THEME.Background
    base.BorderSizePixel = 0
    base.Parent = macLib
    
    -- Main Glow/Stroke
    local baseCorner = Instance.new("UICorner", base)
    baseCorner.CornerRadius = UDim.new(0, 14)
    
    local baseStroke = Instance.new("UIStroke", base)
    baseStroke.Thickness = 2
    baseStroke.Transparency = 0.4
    baseStroke.Color = THEME.SectionStroke
    baseStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    -- Dragging
    local dragging, dragInput, dragStart, startPos
    base.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = base.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    base.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Tween(base, TweenInfo.new(0.05), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)})
        end
    end)

    --// Toggle GUI Logic (Left Control)
    local isVisible = true
    local function ToggleUI()
        isVisible = not isVisible
        if isVisible then
            base.Visible = true
            Tween(base, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {GroupTransparency = 0, Size = MainSize})
        else
            -- Scale down slightly and fade out
            Tween(base, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                GroupTransparency = 1, 
                Size = UDim2.new(0, MainSize.X.Offset * 0.9, 0, MainSize.Y.Offset * 0.9)
            })
            task.delay(0.3, function() if not isVisible then base.Visible = false end end)
        end
    end

    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.LeftControl then
            ToggleUI()
        end
    end)

    -- Opening Animation (Initial)
    base.GroupTransparency = 1
    base.Size = UDim2.new(0, MainSize.X.Offset * 0.9, 0, MainSize.Y.Offset * 0.9)
    base.Visible = true
    Tween(base, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {GroupTransparency = 0, Size = MainSize})

    --// TopBar (Reduced Height)
    local topBarHeight = 38 -- Reduced by ~15%
    local topBar = Instance.new("Frame")
    topBar.Name = "TopBar"
    topBar.Parent = base
    topBar.BackgroundColor3 = THEME.Sidebar
    topBar.BackgroundTransparency = 0.5
    topBar.BorderSizePixel = 0
    topBar.Size = UDim2.new(1, 0, 0, topBarHeight)
    
    local titleLbl = Instance.new("TextLabel")
    titleLbl.Parent = topBar
    titleLbl.BackgroundTransparency = 1
    titleLbl.Position = UDim2.new(0, 16, 0, 0)
    titleLbl.Size = UDim2.new(1, -100, 1, 0)
    titleLbl.Font = THEME.FontBold
    titleLbl.Text = Settings.Title or "Chilli Interface"
    titleLbl.TextXAlignment = Enum.TextXAlignment.Left
    titleLbl.TextSize = 18
    titleLbl.TextColor3 = THEME.Text
    
    -- Gradient Title
    local titleGrad = Instance.new("UIGradient", titleLbl)
    titleGrad.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0.00, Color3.fromRGB(34, 211, 238)), -- Cyan
        ColorSequenceKeypoint.new(1.00, Color3.fromRGB(99, 102, 241)), -- Indigo
    })

    -- Close Button (Hide Only)
    local closeBtn = Instance.new("TextButton", topBar)
    closeBtn.Size = UDim2.fromOffset(24, 24)
    closeBtn.Position = UDim2.new(1, -34, 0.5, -12)
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
    closeBtn.BackgroundTransparency = 0.8
    closeBtn.Text = "X"
    closeBtn.Font = THEME.FontBold
    closeBtn.TextSize = 14
    closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
    closeBtn.AutoButtonColor = true
    Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)

    closeBtn.MouseButton1Click:Connect(function()
        ToggleUI() -- Just toggle visibility
    end)

    --// Layout Containers
    local sideBarWidth = 120 -- Narrower Sidebar
    
    -- Content Area
    local contentArea = Instance.new("Frame", base)
    contentArea.BackgroundColor3 = Color3.fromRGB(0,0,0)
    contentArea.BackgroundTransparency = 1
    contentArea.Position = UDim2.new(0, 0, 0, topBarHeight)
    contentArea.Size = UDim2.new(1, 0, 1, -topBarHeight)

    -- Sidebar (Tabs)
    local sideBar = Instance.new("ScrollingFrame", contentArea)
    sideBar.Name = "Sidebar"
    sideBar.Size = UDim2.new(0, sideBarWidth, 1, 0)
    sideBar.BackgroundColor3 = THEME.Sidebar
    sideBar.BorderSizePixel = 0
    sideBar.ScrollBarThickness = 0
    sideBar.CanvasSize = UDim2.new(0,0,0,0)
    sideBar.AutomaticCanvasSize = Enum.AutomaticSize.Y
    
    local sideList = Instance.new("UIListLayout", sideBar)
    sideList.Padding = UDim.new(0, 4)
    sideList.SortOrder = Enum.SortOrder.LayoutOrder
    
    local sidePad = Instance.new("UIPadding", sideBar)
    sidePad.PaddingTop = UDim.new(0, 10)
    sidePad.PaddingLeft = UDim.new(0, 0) -- Adjusted for active bar

    -- Separator Line
    local sep = Instance.new("Frame", contentArea)
    sep.Size = UDim2.new(0, 1, 1, 0)
    sep.Position = UDim2.new(0, sideBarWidth, 0, 0)
    sep.BackgroundColor3 = THEME.Div
    sep.BorderSizePixel = 0

    -- Pages Container
    local pages = Instance.new("Frame", contentArea)
    pages.Size = UDim2.new(1, -sideBarWidth, 1, 0)
    pages.Position = UDim2.new(0, sideBarWidth, 0, 0)
    pages.BackgroundTransparency = 1
    pages.ClipsDescendants = true

    local tabButtons = {}
    local currentTab = nil

    --// Tab System
    function WindowFunctions:TabGroup() -- Compatibility wrapper
        local GroupFuncs = {}
        function GroupFuncs:Tab(TabSettings)
            local TabFuncs = {}
            
            -- Tab Button Frame
            local tabBtn = Instance.new("TextButton", sideBar)
            tabBtn.Size = UDim2.new(1, 0, 0, 32)
            tabBtn.BackgroundTransparency = 1
            tabBtn.Text = ""
            tabBtn.AutoButtonColor = false

            -- Active Indicator Bar (Left)
            local activeBar = Instance.new("Frame", tabBtn)
            activeBar.Name = "ActiveBar"
            activeBar.BackgroundColor3 = THEME.Accent
            activeBar.Size = UDim2.new(0, 3, 0.6, 0)
            activeBar.Position = UDim2.new(0, 0, 0.2, 0)
            activeBar.BorderSizePixel = 0
            activeBar.BackgroundTransparency = 1 -- Hidden by default
            Instance.new("UICorner", activeBar).CornerRadius = UDim.new(0, 2)

            local tabTitle = Instance.new("TextLabel", tabBtn)
            tabTitle.BackgroundTransparency = 1
            tabTitle.Position = UDim2.new(0, 14, 0, 0) -- Shifted left
            tabTitle.Size = UDim2.new(1, -20, 1, 0)
            tabTitle.Font = THEME.FontSemi
            tabTitle.Text = TabSettings.Title or "Tab"
            tabTitle.TextSize = 13
            tabTitle.TextColor3 = THEME.TextMuted
            tabTitle.TextXAlignment = Enum.TextXAlignment.Left

            -- Tab Page
            local pageFrame = Instance.new("ScrollingFrame", pages)
            pageFrame.Size = UDim2.fromScale(1,1)
            pageFrame.BackgroundTransparency = 1
            pageFrame.Visible = false
            pageFrame.ScrollBarThickness = 3
            pageFrame.ScrollBarImageColor3 = THEME.Accent
            pageFrame.BorderSizePixel = 0
            pageFrame.CanvasSize = UDim2.new(0,0,0,0)
            pageFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
            
            local pageList = Instance.new("UIListLayout", pageFrame)
            pageList.Padding = UDim.new(0, 12)
            pageList.SortOrder = Enum.SortOrder.LayoutOrder
            
            local pagePad = Instance.new("UIPadding", pageFrame)
            pagePad.PaddingTop = UDim.new(0, 15)
            pagePad.PaddingLeft = UDim.new(0, 15)
            pagePad.PaddingRight = UDim.new(0, 15)
            pagePad.PaddingBottom = UDim.new(0, 15)

            local function Activate()
                if currentTab == tabBtn then return end
                
                -- Deactivate old
                for btn, data in pairs(tabButtons) do
                    Tween(data.Bar, TweenInfo.new(0.2), {BackgroundTransparency = 1, Size = UDim2.new(0, 3, 0.6, 0)})
                    Tween(data.Title, TweenInfo.new(0.2), {TextColor3 = THEME.TextMuted})
                    data.Page.Visible = false
                end
                
                -- Activate new
                currentTab = tabBtn
                pageFrame.Visible = true
                
                -- Animate Bar & Text
                Tween(activeBar, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {BackgroundTransparency = 0, Size = UDim2.new(0, 3, 0.8, 0)})
                Tween(tabTitle, TweenInfo.new(0.3), {TextColor3 = THEME.Text})
                
                -- Animate Page Entry
                pageFrame.Position = UDim2.new(0, 10, 0, 0)
                pageFrame.CanvasGroupTransparency = 1 
                Tween(pageFrame, TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(0,0,0,0), CanvasGroupTransparency = 0})
            end

            tabBtn.MouseButton1Click:Connect(Activate)
            tabButtons[tabBtn] = {Page = pageFrame, Title = tabTitle, Bar = activeBar}
            
            if currentTab == nil then Activate() end

            function TabFuncs:Select() Activate() end

            --// SECTIONS
            function TabFuncs:Section(SecSettings)
                local SecFuncs = {}
                
                local sectionContainer = Instance.new("Frame", pageFrame)
                sectionContainer.BackgroundColor3 = THEME.Section
                sectionContainer.BackgroundTransparency = 0 -- Blueish background
                sectionContainer.Size = UDim2.new(1, 0, 0, 32) -- Initial collapsed size
                sectionContainer.AutomaticSize = Enum.AutomaticSize.Y
                sectionContainer.ClipsDescendants = true
                
                local secCorner = Instance.new("UICorner", sectionContainer)
                secCorner.CornerRadius = UDim.new(0, 10)
                
                local secStroke = Instance.new("UIStroke", sectionContainer)
                secStroke.Color = THEME.SectionStroke
                secStroke.Transparency = 0.6
                secStroke.Thickness = 1

                -- Content Holder (for animation)
                local contentHolder = Instance.new("Frame", sectionContainer)
                contentHolder.Name = "Content"
                contentHolder.Size = UDim2.new(1, 0, 0, 0)
                contentHolder.Position = UDim2.new(0, 0, 0, 32) -- Starts below header
                contentHolder.BackgroundTransparency = 1
                contentHolder.AutomaticSize = Enum.AutomaticSize.Y
                
                local contentList = Instance.new("UIListLayout", contentHolder)
                contentList.Padding = UDim.new(0, 8)
                contentList.SortOrder = Enum.SortOrder.LayoutOrder
                contentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
                
                local contentPad = Instance.new("UIPadding", contentHolder)
                contentPad.PaddingTop = UDim.new(0, 8)
                contentPad.PaddingBottom = UDim.new(0, 12)
                contentPad.PaddingLeft = UDim.new(0, 10)
                contentPad.PaddingRight = UDim.new(0, 10)

                -- Header Button
                local headerBtn = Instance.new("TextButton", sectionContainer)
                headerBtn.Size = UDim2.new(1, 0, 0, 32)
                headerBtn.BackgroundTransparency = 1
                headerBtn.Text = ""
                headerBtn.ZIndex = 2 -- Above content

                local headerLbl = Instance.new("TextLabel", headerBtn)
                headerLbl.Text = SecSettings.Title or "Section"
                headerLbl.Font = THEME.FontBold
                headerLbl.TextSize = 14
                headerLbl.TextColor3 = THEME.Text
                headerLbl.Size = UDim2.new(1, -30, 1, 0)
                headerLbl.Position = UDim2.new(0, 12, 0, 0)
                headerLbl.BackgroundTransparency = 1
                headerLbl.TextXAlignment = Enum.TextXAlignment.Left
                
                local arrow = Instance.new("TextLabel", headerBtn)
                arrow.Text = "▼" -- Down arrow
                arrow.TextColor3 = THEME.Accent
                arrow.BackgroundTransparency = 1
                arrow.Size = UDim2.new(0, 30, 1, 0)
                arrow.Position = UDim2.new(1, -30, 0, 0)
                arrow.TextSize = 12
                arrow.Rotation = 180 -- Starts expanded (Up arrow visual logic)

                -- Collapse Logic (Smooth Accordion)
                local expanded = true
                headerBtn.MouseButton1Click:Connect(function()
                    expanded = not expanded
                    
                    if expanded then
                        Tween(arrow, TweenInfo.new(0.3), {Rotation = 180})
                        contentHolder.Visible = true
                        -- Allow AutoSize to take over or tween maxheight
                        -- For simplicity in Roblox layouts:
                        sectionContainer.AutomaticSize = Enum.AutomaticSize.Y
                    else
                        Tween(arrow, TweenInfo.new(0.3), {Rotation = 0})
                        sectionContainer.AutomaticSize = Enum.AutomaticSize.None
                        Tween(sectionContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 32)})
                        task.delay(0.3, function() if not expanded then contentHolder.Visible = false end end)
                    end
                end)

                -- Element Helpers
                local function MakeElement(height)
                    local el = Instance.new("Frame", contentHolder)
                    el.Size = UDim2.new(1, 0, 0, height or 38)
                    el.BackgroundColor3 = Color3.fromRGB(15, 23, 42) -- Darker inner
                    el.BackgroundTransparency = 0.5
                    local elCorn = Instance.new("UICorner", el)
                    elCorn.CornerRadius = UDim.new(0, 6)
                    local elStr = Instance.new("UIStroke", el)
                    elStr.Color = THEME.Div
                    elStr.Transparency = 0.5
                    return el
                end
                
                local function AddTitle(parent, text)
                    local lbl = Instance.new("TextLabel", parent)
                    lbl.Size = UDim2.new(1, -10, 1, 0)
                    lbl.Position = UDim2.new(0, 10, 0, 0)
                    lbl.BackgroundTransparency = 1
                    lbl.Text = text or "Element"
                    lbl.Font = THEME.FontSemi
                    lbl.TextSize = 13
                    lbl.TextColor3 = THEME.Text
                    lbl.TextXAlignment = Enum.TextXAlignment.Left
                    return lbl
                end

                -- [BUTTON]
                function SecFuncs:Button(BSettings)
                    local btnCont = MakeElement(34)
                    btnCont.BackgroundColor3 = THEME.Accent
                    btnCont.BackgroundTransparency = 0.9
                    
                    local btn = Instance.new("TextButton", btnCont)
                    btn.Size = UDim2.fromScale(1,1)
                    btn.BackgroundTransparency = 1
                    btn.Text = BSettings.Title or "Button"
                    btn.Font = THEME.FontBold
                    btn.TextColor3 = THEME.Accent
                    btn.TextSize = 13
                    
                    btn.MouseButton1Click:Connect(function()
                        SafeCallback(BSettings.Callback)
                        Tween(btn, TweenInfo.new(0.1), {TextSize = 11})
                        task.wait(0.1)
                        Tween(btn, TweenInfo.new(0.1), {TextSize = 13})
                    end)
                    return {SetTitle = function(self, t) btn.Text = t end}
                end

                -- [TOGGLE]
                function SecFuncs:Toggle(TSettings, Flag)
                    local togCont = MakeElement(38)
                    AddTitle(togCont, TSettings.Title)
                    
                    local togBtn = Instance.new("TextButton", togCont)
                    togBtn.Size = UDim2.fromScale(1,1)
                    togBtn.BackgroundTransparency = 1
                    togBtn.Text = ""
                    
                    local switchBg = Instance.new("Frame", togCont)
                    switchBg.Size = UDim2.fromOffset(36, 18)
                    switchBg.Position = UDim2.new(1, -46, 0.5, -9)
                    switchBg.BackgroundColor3 = THEME.Sidebar
                    Instance.new("UICorner", switchBg).CornerRadius = UDim.new(1, 0)
                    
                    local knob = Instance.new("Frame", switchBg)
                    knob.Size = UDim2.fromOffset(14, 14)
                    knob.Position = UDim2.new(0, 2, 0.5, -7)
                    knob.BackgroundColor3 = THEME.Text
                    Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)
                    
                    local toggled = TSettings.Default or false
                    local Funcs = {Value = toggled}
                    
                    local function Update(state)
                        toggled = state
                        Funcs.Value = state
                        if toggled then
                            Tween(switchBg, TweenInfo.new(0.2), {BackgroundColor3 = THEME.Accent})
                            Tween(knob, TweenInfo.new(0.2), {Position = UDim2.new(1, -16, 0.5, -7)})
                        else
                            Tween(switchBg, TweenInfo.new(0.2), {BackgroundColor3 = THEME.Sidebar})
                            Tween(knob, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -7)})
                        end
                        SafeCallback(TSettings.Callback, toggled)
                    end
                    
                    Update(toggled)
                    togBtn.MouseButton1Click:Connect(function() Update(not toggled) end)
                    
                    function Funcs:Set(v) Update(v) end
                    if Flag then MacLib.Options[Flag] = Funcs end
                    return Funcs
                end

                -- [SLIDER]
                function SecFuncs:Slider(SSettings, Flag)
                    local slidCont = MakeElement(50)
                    AddTitle(slidCont, SSettings.Title).Size = UDim2.new(1, -10, 0, 25)
                    
                    local valLbl = Instance.new("TextLabel", slidCont)
                    valLbl.Size = UDim2.new(0, 50, 0, 25)
                    valLbl.Position = UDim2.new(1, -60, 0, 0)
                    valLbl.BackgroundTransparency = 1
                    valLbl.Text = tostring(SSettings.Default or SSettings.Minimum)
                    valLbl.TextColor3 = THEME.Accent
                    valLbl.Font = THEME.FontBold
                    valLbl.TextSize = 13
                    valLbl.TextXAlignment = Enum.TextXAlignment.Right
                    
                    local slideBg = Instance.new("Frame", slidCont)
                    slideBg.Size = UDim2.new(1, -20, 0, 4)
                    slideBg.Position = UDim2.new(0, 10, 0, 32)
                    slideBg.BackgroundColor3 = THEME.Sidebar
                    Instance.new("UICorner", slideBg).CornerRadius = UDim.new(1, 0)
                    
                    local fill = Instance.new("Frame", slideBg)
                    fill.Size = UDim2.new(0, 0, 1, 0)
                    fill.BackgroundColor3 = THEME.Accent
                    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)
                    
                    local min, max = SSettings.Minimum or 0, SSettings.Maximum or 100
                    local value = SSettings.Default or min
                    local Funcs = {Value = value}
                    
                    local function Update(input)
                        local sizeX = slideBg.AbsoluteSize.X
                        local mousePos = (input.Position.X - slideBg.AbsolutePosition.X)
                        local percent = math.clamp(mousePos / sizeX, 0, 1)
                        value = math.floor(min + (max - min) * percent)
                        Funcs.Value = value
                        
                        Tween(fill, TweenInfo.new(0.05), {Size = UDim2.new(percent, 0, 1, 0)})
                        valLbl.Text = tostring(value)
                        SafeCallback(SSettings.Callback, value)
                    end
                    
                    local percent = (value - min) / (max - min)
                    fill.Size = UDim2.new(percent, 0, 1, 0)
                    
                    local dragging = false
                    local btn = Instance.new("TextButton", slideBg)
                    btn.Size = UDim2.fromScale(1,1)
                    btn.BackgroundTransparency = 1
                    btn.Text = ""
                    
                    btn.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 then
                            dragging = true
                            Update(input)
                        end
                    end)
                    UserInputService.InputEnded:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
                    end)
                    UserInputService.InputChanged:Connect(function(input)
                        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then Update(input) end
                    end)
                    
                    function Funcs:Set(v)
                        value = math.clamp(v, min, max)
                        local p = (value - min) / (max - min)
                        Tween(fill, TweenInfo.new(0.2), {Size = UDim2.new(p, 0, 1, 0)})
                        valLbl.Text = tostring(value)
                        SafeCallback(SSettings.Callback, value)
                    end
                    if Flag then MacLib.Options[Flag] = Funcs end
                    return Funcs
                end

                -- [INPUT]
                function SecFuncs:Input(ISettings, Flag)
                    local inpCont = MakeElement(38)
                    AddTitle(inpCont, ISettings.Title)
                    
                    local boxBg = Instance.new("Frame", inpCont)
                    boxBg.Size = UDim2.new(0, 100, 0, 24)
                    boxBg.Position = UDim2.new(1, -110, 0.5, -12)
                    boxBg.BackgroundColor3 = THEME.Background
                    Instance.new("UICorner", boxBg).CornerRadius = UDim.new(0, 4)
                    local bStr = Instance.new("UIStroke", boxBg)
                    bStr.Color = THEME.Div
                    
                    local box = Instance.new("TextBox", boxBg)
                    box.Size = UDim2.new(1, -10, 1, 0)
                    box.Position = UDim2.new(0, 5, 0, 0)
                    box.BackgroundTransparency = 1
                    box.Text = ISettings.Default or ""
                    box.PlaceholderText = ISettings.Placeholder or "..."
                    box.TextColor3 = THEME.Text
                    box.Font = THEME.FontNormal
                    box.TextSize = 13
                    
                    local Funcs = {Value = box.Text}
                    
                    box.FocusLost:Connect(function()
                        Funcs.Value = box.Text
                        SafeCallback(ISettings.Callback, box.Text)
                    end)
                    
                    function Funcs:Set(t)
                        box.Text = t
                        Funcs.Value = t
                    end
                    if Flag then MacLib.Options[Flag] = Funcs end
                    return Funcs
                end

                 -- [DROPDOWN]
                 function SecFuncs:Dropdown(DSettings, Flag)
                    local dropCont = MakeElement(38)
                    dropCont.ClipsDescendants = true
                    AddTitle(dropCont, DSettings.Title)
                    
                    local current = DSettings.Default or "..."
                    local Funcs = {Value = current}
                    
                    local selectedLbl = Instance.new("TextLabel", dropCont)
                    selectedLbl.Size = UDim2.new(0, 100, 0, 38)
                    selectedLbl.Position = UDim2.new(1, -130, 0, 0)
                    selectedLbl.Text = current
                    selectedLbl.Font = THEME.FontNormal
                    selectedLbl.TextColor3 = THEME.TextMuted
                    selectedLbl.TextXAlignment = Enum.TextXAlignment.Right
                    selectedLbl.BackgroundTransparency = 1
                    
                    local arrow = Instance.new("TextLabel", dropCont)
                    arrow.Text = "▼"
                    arrow.Size = UDim2.new(0, 20, 0, 38)
                    arrow.Position = UDim2.new(1, -25, 0, 0)
                    arrow.BackgroundTransparency = 1
                    arrow.TextColor3 = THEME.TextMuted
                    
                    local openBtn = Instance.new("TextButton", dropCont)
                    openBtn.Size = UDim2.new(1, 0, 0, 38)
                    openBtn.BackgroundTransparency = 1
                    openBtn.Text = ""
                    
                    local listFrame = Instance.new("Frame", dropCont)
                    listFrame.Size = UDim2.new(1, -10, 0, 0)
                    listFrame.Position = UDim2.new(0, 5, 0, 40)
                    listFrame.BackgroundTransparency = 1
                    local lLayout = Instance.new("UIListLayout", listFrame)
                    lLayout.Padding = UDim.new(0, 4)
                    
                    local expanded = false
                    
                    local function RefreshList()
                        for _, c in pairs(listFrame:GetChildren()) do
                            if c:IsA("TextButton") then c:Destroy() end
                        end
                        for _, opt in ipairs(DSettings.Options or {}) do
                            local optBtn = Instance.new("TextButton", listFrame)
                            optBtn.Size = UDim2.new(1, 0, 0, 26)
                            optBtn.BackgroundColor3 = THEME.Sidebar
                            optBtn.Text = opt
                            optBtn.Font = THEME.FontNormal
                            optBtn.TextColor3 = THEME.Text
                            optBtn.TextSize = 13
                            Instance.new("UICorner", optBtn).CornerRadius = UDim.new(0, 6)
                            
                            optBtn.MouseButton1Click:Connect(function()
                                current = opt
                                Funcs.Value = opt
                                selectedLbl.Text = opt
                                SafeCallback(DSettings.Callback, opt)
                                expanded = false
                                Tween(dropCont, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 38)})
                                Tween(arrow, TweenInfo.new(0.3), {Rotation = 0})
                            end)
                        end
                        listFrame.Size = UDim2.new(1, -10, 0, #DSettings.Options * 30)
                    end
                    
                    RefreshList()
                    
                    openBtn.MouseButton1Click:Connect(function()
                        expanded = not expanded
                        Tween(dropCont, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, expanded and (45 + listFrame.Size.Y.Offset) or 38)})
                        Tween(arrow, TweenInfo.new(0.3), {Rotation = expanded and 180 or 0})
                    end)
                    
                    function Funcs:Set(v)
                        current = v
                        selectedLbl.Text = v
                    end
                    function Funcs:Refresh(list)
                        DSettings.Options = list
                        RefreshList()
                    end
                    
                    if Flag then MacLib.Options[Flag] = Funcs end
                    return Funcs
                end

                -- [PARAGRAPH] (Improved Style)
                function SecFuncs:Paragraph(PSettings)
                    local par = MakeElement(60)
                    par.BackgroundTransparency = 1
                    -- Add prominent stroke
                    local pStr = par:FindFirstChild("UIStroke")
                    if pStr then 
                        pStr.Color = THEME.SectionStroke
                        pStr.Transparency = 0.6
                        pStr.Thickness = 1.5
                    end
                    
                    local title = AddTitle(par, PSettings.Title)
                    title.Font = THEME.FontBold
                    title.TextSize = 14
                    title.TextColor3 = THEME.Accent
                    
                    local desc = Instance.new("TextLabel", par)
                    desc.Size = UDim2.new(1, -20, 1, -24)
                    desc.Position = UDim2.new(0, 10, 0, 24)
                    desc.BackgroundTransparency = 1
                    desc.Text = PSettings.Desc or "Description"
                    desc.TextColor3 = THEME.Text
                    desc.TextSize = 13
                    desc.TextWrapped = true
                    desc.TextXAlignment = Enum.TextXAlignment.Left
                    desc.TextYAlignment = Enum.TextYAlignment.Top
                    desc.Font = THEME.FontNormal
                end

                -- [LABEL]
                function SecFuncs:Label(Text)
                    local lbl = MakeElement(24)
                    lbl.BackgroundTransparency = 1
                    if lbl:FindFirstChild("UIStroke") then lbl.UIStroke:Destroy() end
                    AddTitle(lbl, Text).Font = THEME.FontNormal
                end

                return SecFuncs
            end
            
            return TabFuncs
        end
        return GroupFuncs
    end

    --// Notification System (Smooth Slide In)
    function WindowFunctions:Notify(NSettings)
        local notif = Instance.new("Frame")
        notif.Size = UDim2.new(1, 0, 0, 60)
        notif.BackgroundTransparency = 1
        notif.Parent = notifications
        
        local card = Instance.new("Frame", notif)
        card.Size = UDim2.new(1, 0, 1, 0)
        card.Position = UDim2.new(1, 50, 0, 0) -- Start off-screen right
        card.BackgroundColor3 = THEME.Background
        
        Instance.new("UICorner", card).CornerRadius = UDim.new(0, 8)
        local cardStroke = Instance.new("UIStroke", card)
        cardStroke.Color = THEME.SectionStroke
        cardStroke.Transparency = 0.5
        
        local title = Instance.new("TextLabel", card)
        title.Position = UDim2.new(0, 12, 0, 8)
        title.Size = UDim2.new(1, -24, 0, 18)
        title.BackgroundTransparency = 1
        title.Font = THEME.FontBold
        title.Text = NSettings.Title or "Notification"
        title.TextColor3 = THEME.Accent
        title.TextSize = 14
        title.TextXAlignment = Enum.TextXAlignment.Left
        
        local desc = Instance.new("TextLabel", card)
        desc.Position = UDim2.new(0, 12, 0, 28)
        desc.Size = UDim2.new(1, -24, 0, 24)
        desc.BackgroundTransparency = 1
        desc.Font = THEME.FontNormal
        desc.Text = NSettings.Desc or "Details"
        desc.TextColor3 = THEME.Text
        desc.TextSize = 12
        desc.TextWrapped = true
        desc.TextXAlignment = Enum.TextXAlignment.Left
        
        -- Animation In
        Tween(card, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Position = UDim2.new(0,0,0,0)})
        
        -- Auto Close
        task.delay(NSettings.Duration or 3, function()
            Tween(card, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Position = UDim2.new(1, 50, 0, 0), BackgroundTransparency = 1})
            task.wait(0.4)
            notif:Destroy()
        end)
    end
    
    function WindowFunctions:Unload()
        macLib:Destroy()
    end

	return WindowFunctions
end

return MacLib
