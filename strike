-- MacLib UI Library (modern, minimal design)
-- Không bao gồm chức năng cụ thể – chỉ dùng để tạo giao diện.
-- Thư viện giữ nguyên API như MacLib cũ: Window → TabGroup → Tab → Section → control.
local MacLib = {}

do
    local TweenService = game:GetService("TweenService")
    local UIS          = game:GetService("UserInputService")

    -- Bảng màu: tone tối hiện đại với accent xanh dịu
    local COLOR_BG_CARD        = Color3.fromRGB(30, 34, 43)
    local COLOR_BG_PANEL       = Color3.fromRGB(36, 40, 50)
    local COLOR_BG_CONTROL     = Color3.fromRGB(42, 46, 56)
    local COLOR_BG_CONTROL_ALT = Color3.fromRGB(50, 56, 70)
    local COLOR_ACCENT         = Color3.fromRGB(94, 161, 255)
    local COLOR_TEXT_PRIMARY   = Color3.fromRGB(235, 238, 245)
    local COLOR_TEXT_SECONDARY = Color3.fromRGB(170, 180, 192)
    local COLOR_BORDER         = Color3.fromRGB(60, 68, 82)

    -- Thẻ nền chính
    local function createCard(parent, size)
        local frame = Instance.new("Frame")
        frame.BackgroundColor3 = COLOR_BG_CARD
        frame.BorderSizePixel  = 0
        frame.Size             = size
        frame.Parent           = parent
        local corner = Instance.new("UICorner", frame)
        corner.CornerRadius = UDim.new(0, 12)
        local stroke = Instance.new("UIStroke", frame)
        stroke.Thickness     = 1.5
        stroke.Color         = COLOR_BORDER
        stroke.Transparency  = 0.4
        return frame
    end

    -- Thanh tiêu đề
    local function createTopBar(parent, title)
        local bar = Instance.new("Frame")
        bar.BackgroundColor3 = COLOR_BG_PANEL
        bar.BorderSizePixel  = 0
        bar.Size             = UDim2.new(1, 0, 0, 46)
        bar.Parent           = parent
        local corner = Instance.new("UICorner", bar)
        corner.CornerRadius = UDim.new(0, 12)
        local lbl = Instance.new("TextLabel")
        lbl.BackgroundTransparency = 1
        lbl.Text               = tostring(title or "")
        lbl.Font               = Enum.Font.GothamBold
        lbl.TextSize           = 18
        lbl.TextColor3         = COLOR_TEXT_PRIMARY
        lbl.Position           = UDim2.new(0, 16, 0, 0)
        lbl.Size               = UDim2.new(1, -32, 1, 0)
        lbl.TextXAlignment     = Enum.TextXAlignment.Left
        lbl.Parent             = bar
        return bar, lbl
    end

    -- Hỗ trợ kéo cửa sổ
    local DragGroup = { frames = {}, dragging = false, dragStart = nil, groupStart = {} }
    function DragGroup:register(frame, topbar)
        table.insert(self.frames, { frame = frame, top = topbar })
        topbar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                self.dragging  = true
                self.dragStart = input.Position
                self.groupStart= {}
                for _, it in ipairs(self.frames) do
                    self.groupStart[it] = it.frame.Position
                end
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        self.dragging = false
                    end
                end)
            end
        end)
        topbar.InputChanged:Connect(function(input)
            if self.dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - self.dragStart
                for _, it in ipairs(self.frames) do
                    local startPos = self.groupStart[it]
                    it.frame.Position = UDim2.new(
                        startPos.X.Scale,
                        startPos.X.Offset + delta.X,
                        startPos.Y.Scale,
                        startPos.Y.Offset + delta.Y
                    )
                end
            end
        end)
    end

    --== Window ==
    function MacLib:Window(opts)
        opts = opts or {}
        local win  = {}
        local sg   = Instance.new("ScreenGui")
        sg.Name            = "MacLibUI"
        sg.IgnoreGuiInset  = true
        sg.ResetOnSpawn    = false
        sg.ZIndexBehavior  = Enum.ZIndexBehavior.Global
        sg.Parent          = game:GetService("CoreGui")

        local size = opts.Size or UDim2.fromOffset(600, 420)
        local card = createCard(sg, size)
        card.Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2)

        local topBar, _ = createTopBar(card, opts.Title or "")

        -- khung chứa tabs và nội dung
        local container = Instance.new("Frame")
        container.BackgroundTransparency = 1
        container.Size       = UDim2.new(1, -20, 1, -60)
        container.Position   = UDim2.new(0, 10, 0, 50)
        container.Parent     = card

        -- khung tabs
        local tabsFrame = Instance.new("Frame")
        tabsFrame.BackgroundColor3 = COLOR_BG_PANEL
        tabsFrame.BorderSizePixel  = 0
        tabsFrame.Size             = UDim2.new(0, 150, 1, 0)
        tabsFrame.Parent           = container
        local cornerTabs = Instance.new("UICorner", tabsFrame)
        cornerTabs.CornerRadius = UDim.new(0, 12)
        -- viền dọc phân chia tabs và nội dung
        local vertLine = Instance.new("Frame")
        vertLine.Size = UDim2.new(0, 1, 1, 0)
        vertLine.Position = UDim2.new(1, 0, 0, 0)
        vertLine.BackgroundColor3 = COLOR_BORDER
        vertLine.BackgroundTransparency = 0.5
        vertLine.Parent = tabsFrame

        local tabsLayout = Instance.new("UIListLayout", tabsFrame)
        tabsLayout.FillDirection = Enum.FillDirection.Vertical
        tabsLayout.SortOrder     = Enum.SortOrder.LayoutOrder
        tabsLayout.Padding       = UDim.new(0, 4)

        -- khung nội dung
        local contentFrame = Instance.new("Frame")
        contentFrame.BackgroundColor3 = COLOR_BG_PANEL
        contentFrame.BorderSizePixel  = 0
        contentFrame.Size             = UDim2.new(1, -170, 1, 0)
        contentFrame.Position         = UDim2.new(0, 160, 0, 0)
        contentFrame.Parent           = container
        local cornerContent = Instance.new("UICorner", contentFrame)
        cornerContent.CornerRadius = UDim.new(0, 12)
        local strokeContent = Instance.new("UIStroke", contentFrame)
        strokeContent.Thickness    = 1
        strokeContent.Color        = COLOR_BORDER
        strokeContent.Transparency = 0.4

        win._tabs      = {}
        win._selected  = nil
        win._sg        = sg
        win._open      = true

        function win:Toggle()
            self._open = not self._open
            sg.Enabled = self._open
        end
        function win:GetOpen() return self._open end
        function win:SetOpen(b) self._open = b; sg.Enabled = b end
        function win:ToggleUI() self:Toggle() end
        function win:ToggleMain() self:Toggle() end

        -- keybind
        if opts.Keybind and typeof(opts.Keybind) == "EnumItem" then
            UIS.InputBegan:Connect(function(input, gp)
                if not gp and input.KeyCode == opts.Keybind then
                    win:Toggle()
                end
            end)
        end

        DragGroup:register(card, topBar)

        -- TabGroup
        local TabGroup = {}
        function TabGroup:Tab(info)
            info = info or {}
            local tab = {}
            tab._sections = {}
            tab._title    = info.Title or "Tab"
            -- nút tab
            local btn = Instance.new("TextButton")
            btn.Text             = tab._title
            btn.Font             = Enum.Font.GothamSemibold
            btn.TextSize         = 14
            btn.TextColor3       = COLOR_TEXT_PRIMARY
            btn.AutoButtonColor  = false
            btn.BackgroundColor3 = COLOR_BG_CONTROL
            btn.Size             = UDim2.new(1, -8, 0, 36)
            btn.Position         = UDim2.new(0, 4, 0, 0)
            btn.Parent           = tabsFrame
            local cornerBtn = Instance.new("UICorner", btn)
            cornerBtn.CornerRadius = UDim.new(0, 8)
            -- viền dưới mỗi tab
            local bottomLine = Instance.new("Frame")
            bottomLine.Size = UDim2.new(1, 0, 0, 1)
            bottomLine.Position = UDim2.new(0, 0, 1, -1)
            bottomLine.BackgroundColor3 = COLOR_BORDER
            bottomLine.BackgroundTransparency = 0.6
            bottomLine.Parent = btn

            -- nội dung tab
            local tabContent = Instance.new("ScrollingFrame")
            tabContent.BackgroundTransparency  = 1
            tabContent.BorderSizePixel         = 0
            tabContent.Position                = UDim2.new(0, 10, 0, 10)
            tabContent.Size                    = UDim2.new(1, -20, 1, -20)
            tabContent.CanvasSize              = UDim2.new(0, 0, 0, 0)
            tabContent.ScrollBarThickness      = 4
            tabContent.ScrollingDirection      = Enum.ScrollingDirection.Y
            tabContent.AutomaticCanvasSize     = Enum.AutomaticSize.Y
            tabContent.Visible                 = false
            tabContent.Parent                  = contentFrame
            local listLayout = Instance.new("UIListLayout", tabContent)
            listLayout.FillDirection = Enum.FillDirection.Vertical
            listLayout.SortOrder     = Enum.SortOrder.LayoutOrder
            listLayout.Padding       = UDim.new(0, 8)

            local function selectThis()
                if win._selected and win._selected._content then
                    win._selected._content.Visible        = false
                    win._selected._button.BackgroundColor3 = COLOR_BG_CONTROL
                end
                win._selected = tab
                tabContent.Visible        = true
                btn.BackgroundColor3      = COLOR_BG_CONTROL_ALT
            end
            btn.MouseButton1Click:Connect(selectThis)
            table.insert(win._tabs, tab)
            if #win._tabs == 1 then selectThis() end

            tab._button = btn
            tab._content = tabContent

            function tab:Section(secInfo)
                secInfo = secInfo or {}
                local section = {}
                section._controls = {}
                -- khung section
                local sFrame = Instance.new("Frame")
                sFrame.BackgroundColor3 = COLOR_BG_CONTROL_ALT
                sFrame.BorderSizePixel  = 0
                sFrame.Size             = UDim2.new(1, 0, 0, 0)
                sFrame.AutomaticSize    = Enum.AutomaticSize.Y
                sFrame.Parent           = tabContent
                local cornerS = Instance.new("UICorner", sFrame)
                cornerS.CornerRadius = UDim.new(0, 10)
                local strokeS = Instance.new("UIStroke", sFrame)
                strokeS.Thickness    = 1
                strokeS.Color        = COLOR_BORDER
                strokeS.Transparency = 0.5

                local layout = Instance.new("UIListLayout", sFrame)
                layout.FillDirection = Enum.FillDirection.Vertical
                layout.SortOrder     = Enum.SortOrder.LayoutOrder
                layout.Padding       = UDim.new(0, 6)

                if secInfo.Title and secInfo.Title ~= "" then
                    local tLbl = Instance.new("TextLabel")
                    tLbl.BackgroundTransparency = 1
                    tLbl.Text               = tostring(secInfo.Title)
                    tLbl.Font               = Enum.Font.GothamBold
                    tLbl.TextSize           = 16
                    tLbl.TextColor3         = COLOR_ACCENT
                    tLbl.Position           = UDim2.new(0, 8, 0, 6)
                    tLbl.Size               = UDim2.new(1, -16, 0, 20)
                    tLbl.TextXAlignment     = Enum.TextXAlignment.Left
                    tLbl.Parent             = sFrame
                end

                -- khung chứa controls
                local cFrame = Instance.new("Frame")
                cFrame.BackgroundTransparency = 1
                cFrame.Size             = UDim2.new(1, -16, 0, 0)
                cFrame.Position         = UDim2.new(0, 8, 0, 0)
                cFrame.AutomaticSize    = Enum.AutomaticSize.Y
                cFrame.Parent           = sFrame
                local cLayout = Instance.new("UIListLayout", cFrame)
                cLayout.FillDirection   = Enum.FillDirection.Vertical
                cLayout.SortOrder       = Enum.SortOrder.LayoutOrder
                cLayout.Padding         = UDim.new(0, 4)

                -- Paragraph
                function section:Paragraph(info)
                    info = info or {}
                    local row = Instance.new("Frame")
                    row.BackgroundColor3 = COLOR_BG_PANEL
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 0)
                    row.AutomaticSize    = Enum.AutomaticSize.Y
                    row.Parent           = cFrame
                    local corner = Instance.new("UICorner", row)
                    corner.CornerRadius = UDim.new(0, 8)
                    local stroke = Instance.new("UIStroke", row)
                    stroke.Thickness    = 1
                    stroke.Color        = COLOR_BORDER
                    stroke.Transparency = 0.6
                    local txt = Instance.new("TextLabel")
                    txt.BackgroundTransparency = 1
                    txt.Font               = Enum.Font.Gotham
                    txt.TextWrapped        = true
                    txt.TextColor3         = COLOR_TEXT_SECONDARY
                    txt.TextSize           = 14
                    txt.TextXAlignment     = Enum.TextXAlignment.Left
                    txt.TextYAlignment     = Enum.TextYAlignment.Top
                    txt.Position           = UDim2.new(0, 8, 0, 6)
                    txt.Size               = UDim2.new(1, -16, 0, 0)
                    txt.AutomaticSize      = Enum.AutomaticSize.Y
                    local fullText = ""
                    if info.Title and info.Title ~= "" then fullText = info.Title end
                    if info.Desc and info.Desc ~= "" then
                        if fullText ~= "" then fullText = fullText .. "\\n" .. info.Desc else fullText = info.Desc end
                    end
                    txt.Text = fullText
                    txt.Parent = row
                    return {}
                end

                -- Button
                function section:Button(info)
                    info = info or {}
                    local row = Instance.new("TextButton")
                    row.BackgroundColor3 = COLOR_BG_CONTROL
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    row.AutoButtonColor  = true
                    row.Text             = ""
                    row.Parent           = cFrame
                    local corner = Instance.new("UICorner", row)
                    corner.CornerRadius = UDim.new(0, 8)
                    local stroke = Instance.new("UIStroke", row)
                    stroke.Thickness    = 1
                    stroke.Color        = COLOR_BORDER
                    stroke.Transparency = 0.6
                    local lbl = Instance.new("TextLabel")
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or "Button")
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT_PRIMARY
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.Size               = UDim2.new(1, -16, 1, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    row.MouseButton1Click:Connect(function()
                        if type(info.Callback) == "function" then
                            task.spawn(info.Callback)
                        end
                    end)
                    return {}
                end

                -- Toggle (có animation)
                function section:Toggle(info)
                    info = info or {}
                    local row = Instance.new("Frame")
                    row.BackgroundColor3 = COLOR_BG_CONTROL
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    row.Parent           = cFrame
                    local corner = Instance.new("UICorner", row)
                    corner.CornerRadius = UDim.new(0, 8)
                    local stroke = Instance.new("UIStroke", row)
                    stroke.Thickness    = 1
                    stroke.Color        = COLOR_BORDER
                    stroke.Transparency = 0.6
                    local lbl = Instance.new("TextLabel")
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or "Toggle")
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT_PRIMARY
                    lbl.Size               = UDim2.new(1, -70, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    -- nền của switch
                    local base = Instance.new("Frame")
                    base.Size               = UDim2.fromOffset(48, 22)
                    base.Position           = UDim2.new(1, -60, 0.5, -11)
                    base.BackgroundColor3   = COLOR_BG_PANEL
                    base.BorderSizePixel    = 0
                    base.Parent             = row
                    local baseCorner = Instance.new("UICorner", base)
                    baseCorner.CornerRadius = UDim.new(0, 11)
                    local baseStroke = Instance.new("UIStroke", base)
                    baseStroke.Thickness    = 1
                    baseStroke.Color        = COLOR_BORDER
                    baseStroke.Transparency = 0.5
                    -- nút
                    local knob = Instance.new("Frame")
                    knob.Size               = UDim2.fromOffset(20, 20)
                    knob.Position           = UDim2.new(0, 1, 0, 1)
                    knob.BackgroundColor3   = COLOR_TEXT_SECONDARY
                    knob.BorderSizePixel    = 0
                    knob.Parent             = base
                    local knobCorner = Instance.new("UICorner", knob)
                    knobCorner.CornerRadius = UDim.new(1, 0)
                    local state = (info.Default == true)
                    local function updateVisual(animated)
                        local targetPos, targetBaseCol, targetKnobCol
                        if state then
                            targetPos    = UDim2.new(1, -21, 0, 1)
                            targetBaseCol= COLOR_ACCENT
                            targetKnobCol= COLOR_BG_PANEL
                        else
                            targetPos    = UDim2.new(0, 1, 0, 1)
                            targetBaseCol= COLOR_BG_PANEL
                            targetKnobCol= COLOR_TEXT_SECONDARY
                        end
                        if animated then
                            TweenService:Create(knob, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = targetPos, BackgroundColor3 = targetKnobCol}):Play()
                            TweenService:Create(base, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundColor3 = targetBaseCol}):Play()
                        else
                            knob.Position        = targetPos
                            knob.BackgroundColor3= targetKnobCol
                            base.BackgroundColor3= targetBaseCol
                        end
                    end
                    updateVisual(false)
                    row.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            state = not state
                            updateVisual(true)
                            if type(info.Callback) == "function" then
                                task.spawn(function() info.Callback(state) end)
                            end
                        end
                    end)
                    return {}
                end

                -- Dropdown
                function section:Dropdown(info)
                    info = info or {}
                    local row = Instance.new("Frame")
                    row.BackgroundColor3 = COLOR_BG_CONTROL
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    row.Parent           = cFrame
                    local corner = Instance.new("UICorner", row)
                    corner.CornerRadius = UDim.new(0, 8)
                    local stroke = Instance.new("UIStroke", row)
                    stroke.Thickness    = 1
                    stroke.Color        = COLOR_BORDER
                    stroke.Transparency = 0.6
                    local lbl = Instance.new("TextLabel")
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or "Select")
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT_PRIMARY
                    lbl.Size               = UDim2.new(1, -80, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    local valueLbl = Instance.new("TextLabel")
                    valueLbl.BackgroundTransparency = 1
                    valueLbl.Text               = ""
                    valueLbl.Font               = Enum.Font.Gotham
                    valueLbl.TextSize           = 13
                    valueLbl.TextColor3         = COLOR_TEXT_SECONDARY
                    valueLbl.Size               = UDim2.new(1, -80, 1, 0)
                    valueLbl.Position           = UDim2.new(0, 8, 0, 0)
                    valueLbl.TextXAlignment     = Enum.TextXAlignment.Right
                    valueLbl.Parent             = row
                    -- danh sách
                    local listFrame = Instance.new("Frame")
                    listFrame.BackgroundColor3 = COLOR_BG_PANEL
                    listFrame.BorderSizePixel  = 0
                    listFrame.Size             = UDim2.new(1, -16, 0, 0)
                    listFrame.Position         = UDim2.new(0, 8, 0, 0)
                    listFrame.Visible          = false
                    listFrame.Parent           = cFrame
                    local cornerLF = Instance.new("UICorner", listFrame)
                    cornerLF.CornerRadius = UDim.new(0, 8)
                    local strokeLF = Instance.new("UIStroke", listFrame)
                    strokeLF.Thickness    = 1
                    strokeLF.Color        = COLOR_BORDER
                    strokeLF.Transparency = 0.6
                    local scroller = Instance.new("ScrollingFrame", listFrame)
                    scroller.BackgroundTransparency = 1
                    scroller.BorderSizePixel        = 0
                    scroller.Size                   = UDim2.new(1, 0, 0, 0)
                    scroller.Position               = UDim2.new(0, 0, 0, 0)
                    scroller.AutomaticSize          = Enum.AutomaticSize.Y
                    scroller.ScrollBarThickness     = 4
                    scroller.ScrollingDirection     = Enum.ScrollingDirection.Y
                    local scLayout = Instance.new("UIListLayout", scroller)
                    scLayout.FillDirection = Enum.FillDirection.Vertical
                    scLayout.SortOrder     = Enum.SortOrder.LayoutOrder
                    scLayout.Padding       = UDim.new(0, 2)
                    local selected = {}
                    local function updateLabel()
                        if info.Multi then
                            local names = {}
                            for _, v in ipairs(selected) do table.insert(names, tostring(v)) end
                            valueLbl.Text = table.concat(names, ", ")
                        else
                            valueLbl.Text = tostring(selected[1] or "")
                        end
                    end
                    local opts = info.Options or {}
                    local defaults = {}
                    if info.Default then
                        if type(info.Default) == "table" then
                            defaults = info.Default
                        else
                            defaults = { info.Default }
                        end
                    end
                    for _, opt in ipairs(opts) do
                        local oBtn = Instance.new("TextButton")
                        oBtn.Text              = tostring(opt)
                        oBtn.Font              = Enum.Font.Gotham
                        oBtn.TextSize          = 14
                        oBtn.TextColor3        = COLOR_TEXT_PRIMARY
                        oBtn.AutoButtonColor   = false
                        oBtn.BackgroundColor3  = COLOR_BG_CONTROL
                        oBtn.BorderSizePixel   = 0
                        oBtn.Size              = UDim2.new(1, -4, 0, 28)
                        oBtn.Parent            = scroller
                        local cornerOB = Instance.new("UICorner", oBtn)
                        cornerOB.CornerRadius = UDim.new(0, 6)
                        local isDef = false
                        for _, d in ipairs(defaults) do
                            if d == opt then isDef = true break end
                        end
                        if isDef then
                            if info.Multi then
                                table.insert(selected, opt)
                            else
                                selected = { opt }
                            end
                            oBtn.BackgroundColor3 = COLOR_ACCENT
                        end
                        oBtn.MouseButton1Click:Connect(function()
                            if info.Multi then
                                local found = false
                                for i, v in ipairs(selected) do
                                    if v == opt then table.remove(selected, i); found = true; break end
                                end
                                if not found then table.insert(selected, opt) end
                                for _, child in ipairs(scroller:GetChildren()) do
                                    if child:IsA("TextButton") then
                                        if table.find(selected, child.Text) then
                                            child.BackgroundColor3 = COLOR_ACCENT
                                        else
                                            child.BackgroundColor3 = COLOR_BG_CONTROL
                                        end
                                    end
                                end
                            else
                                selected = { opt }
                                for _, child in ipairs(scroller:GetChildren()) do
                                    if child:IsA("TextButton") then child.BackgroundColor3 = COLOR_BG_CONTROL end
                                end
                                oBtn.BackgroundColor3 = COLOR_ACCENT
                                listFrame.Visible = false
                            end
                            updateLabel()
                            if type(info.Callback) == "function" then
                                local out
                                if info.Multi then
                                    out = {}
                                    for _, v in ipairs(selected) do out[v] = true end
                                else
                                    out = selected[1]
                                end
                                task.spawn(function() info.Callback(out) end)
                            end
                        end)
                    end
                    updateLabel()
                    row.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            listFrame.Visible = not listFrame.Visible
                        end
                    end)
                    task.defer(function()
                        scroller.Size = UDim2.new(1, 0, 0, math.min(#opts * 30, 120))
                        listFrame.Size = UDim2.new(1, 0, 0, scroller.Size.Y.Offset + 8)
                    end)
                    return {}
                end

                -- Input
                function section:Input(info)
                    info = info or {}
                    local row = Instance.new("Frame")
                    row.BackgroundColor3 = COLOR_BG_CONTROL
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    row.Parent           = cFrame
                    local corner = Instance.new("UICorner", row)
                    corner.CornerRadius = UDim.new(0, 8)
                    local stroke = Instance.new("UIStroke", row)
                    stroke.Thickness    = 1
                    stroke.Color        = COLOR_BORDER
                    stroke.Transparency = 0.6
                    local lbl = Instance.new("TextLabel")
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or "Input")
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT_PRIMARY
                    lbl.Size               = UDim2.new(0.5, -8, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    local tb = Instance.new("TextBox")
                    tb.BackgroundColor3    = COLOR_BG_PANEL
                    tb.BorderSizePixel     = 0
                    tb.Size                = UDim2.new(0.5, -12, 1, -10)
                    tb.Position            = UDim2.new(0.5, 4, 0, 5)
                    tb.Font                = Enum.Font.Gotham
                    tb.TextSize            = 14
                    tb.TextColor3          = COLOR_TEXT_PRIMARY
                    tb.PlaceholderText     = tostring(info.Placeholder or "")
                    tb.Text                = tostring(info.Default or "")
                    local cornerTB = Instance.new("UICorner", tb)
                    cornerTB.CornerRadius = UDim.new(0, 6)
                    tb.Parent             = row
                    tb.FocusLost:Connect(function()
                        if type(info.Callback) == "function" then
                            task.spawn(function() info.Callback(tb.Text) end)
                        end
                    end)
                    return {}
                end

                return section
            end

            return tab
        end

        win._tabGroup = TabGroup
        function win:TabGroup() return TabGroup end

        _G.__MAC_WINDOW = win
        return win
    end
end

return MacLib
