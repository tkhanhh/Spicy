--== Load Mac Library thay cho Ash-Libs ==--
-- Đã thay thế MacLib gốc bằng một thư viện UI tuỳ chỉnh mô phỏng phong cách Chilli Finder.
-- Thư viện này dựng một cửa sổ chính với thanh tab bên trái và khu vực điều khiển bên phải.
-- Các hàm Window, TabGroup, Tab, Section và các control (Toggle, Dropdown, Input, Button, Paragraph) được xây dựng lại
-- để sử dụng giao diện tối, hiện đại, tối giản dựa trên bảng màu của Chilli Finder.
local MacLib = {}
do
    --==========================
    -- Palette & Helpers
    --==========================
    local COLOR_BASE_BG      = Color3.fromRGB(16, 24, 39)
    local COLOR_CARD_GRAD_1  = Color3.fromRGB(12, 18, 32)
    local COLOR_CARD_GRAD_2  = Color3.fromRGB(21, 30, 47)
    local COLOR_CARD_GRAD_3  = Color3.fromRGB(10, 82, 120)
    local COLOR_SURFACE      = Color3.fromRGB(30, 41, 59)
    local COLOR_SURFACE_DARK = Color3.fromRGB(25, 32, 48)
    local COLOR_TEAL_ON      = Color3.fromRGB(52, 180, 230)
    local COLOR_STROKE_GLOW  = Color3.fromRGB(56, 189, 248)
    local COLOR_STROKE_MAIN  = Color3.fromRGB(56, 189, 248)
    local COLOR_TEXT         = Color3.fromRGB(241, 245, 249)
    local COLOR_TEXT_MUTED   = Color3.fromRGB(148, 163, 184)

    local function makeCard(parent, sizeUDim2)
        -- Tạo thẻ có nền gradient và stroke mờ
        local frame = Instance.new('Frame')
        frame.BackgroundColor3 = COLOR_BASE_BG
        frame.BorderSizePixel  = 0
        frame.Size             = sizeUDim2
        frame.Parent           = parent
        Instance.new('UICorner', frame).CornerRadius = UDim.new(0, 20)
        -- gradient nền
        local g = Instance.new('UIGradient', frame)
        g.Rotation = 35
        g.Color    = ColorSequence.new({
            ColorSequenceKeypoint.new(0.00, COLOR_CARD_GRAD_1),
            ColorSequenceKeypoint.new(0.55, COLOR_CARD_GRAD_2),
            ColorSequenceKeypoint.new(1.00, COLOR_CARD_GRAD_3),
        })
        -- vệt sáng mờ bên ngoài
        local s1 = Instance.new('UIStroke', frame)
        s1.Thickness     = 8
        s1.Transparency  = 0.9
        s1.LineJoinMode  = Enum.LineJoinMode.Round
        s1.Color         = COLOR_STROKE_GLOW
        -- viền chính
        local s2 = Instance.new('UIStroke', frame)
        s2.Thickness     = 2
        s2.Transparency  = 0.15
        s2.LineJoinMode  = Enum.LineJoinMode.Round
        s2.Color         = COLOR_STROKE_MAIN
        return frame
    end

    local function makeTopBar(parent, title)
        -- Tạo thanh tiêu đề ở trên
        local bar = Instance.new('Frame')
        bar.Name                   = 'TopBar'
        bar.Parent                 = parent
        bar.BackgroundColor3       = Color3.fromRGB(18, 26, 42)
        bar.BackgroundTransparency = 0.15
        bar.BorderSizePixel        = 0
        bar.Size                   = UDim2.new(1, 0, 0, 46)
        Instance.new('UICorner', bar).CornerRadius = UDim.new(0, 20)
        local lbl = Instance.new('TextLabel')
        lbl.Name            = 'Title'
        lbl.BackgroundTransparency = 1
        lbl.Position        = UDim2.new(0, 16, 0, 0)
        lbl.Size            = UDim2.new(1, -160, 1, 0)
        lbl.Font            = Enum.Font.GothamBold
        lbl.Text            = title or ''
        lbl.TextXAlignment  = Enum.TextXAlignment.Left
        lbl.TextSize        = 16
        lbl.TextColor3      = COLOR_TEXT
        lbl.AutoLocalize    = false
        lbl.Parent          = bar
        -- gradient màu tiêu đề
        local grad = Instance.new('UIGradient', lbl)
        grad.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0.00, Color3.fromRGB(34, 211, 238)),
            ColorSequenceKeypoint.new(0.50, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1.00, Color3.fromRGB(99, 102, 241)),
        })
        return bar, lbl
    end

    -- Nhóm kéo cho cửa sổ (DragGroup): hỗ trợ kéo toàn bộ cửa sổ
    local DragGroup = { frames = {}, dragging = false, dragStart = nil, groupStart = {} }
    function DragGroup:register(frame, topbar)
        table.insert(self.frames, { frame = frame, top = topbar })
        topbar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                self.dragging  = true
                self.dragStart = input.Position
                self.groupStart= {}
                for _, it in ipairs(self.frames) do
                    self.groupStart[it] = it.frame.Position
                end
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        self.dragging = false
                    end
                end)
            end
        end)
        topbar.InputChanged:Connect(function(input)
            if self.dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - self.dragStart
                for _, it in ipairs(self.frames) do
                    local startPos = self.groupStart[it]
                    it.frame.Position = UDim2.new(
                        startPos.X.Scale,
                        startPos.X.Offset + delta.X,
                        startPos.Y.Scale,
                        startPos.Y.Offset + delta.Y
                    )
                end
            end
        end)
    end

    --==========================
    -- MacLib.Window Implementation
    --==========================
    function MacLib:Window(opts)
        opts = opts or {}
        local window = {}
        local UIS = game:GetService("UserInputService")
        -- Create ScreenGui for the window
        local sg = Instance.new('ScreenGui')
        sg.Name            = 'ChilliMacUI'
        sg.IgnoreGuiInset  = true
        sg.ResetOnSpawn    = false
        sg.ZIndexBehavior  = Enum.ZIndexBehavior.Global
        sg.Parent          = game:GetService('CoreGui')
        -- main card
        local size = opts.Size or UDim2.fromOffset(860, 560)
        local card = makeCard(sg, size)
        -- centering by default
        card.Position      = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2)
        -- top bar
        local topBar, titleLbl = makeTopBar(card, opts.Title or '')
        -- container for sidebar and content
        local container = Instance.new('Frame')
        container.Name = 'Container'
        container.BackgroundTransparency = 1
        container.Size = UDim2.new(1, -20, 1, -60)
        container.Position = UDim2.new(0, 10, 0, 50)
        container.Parent = card
        -- left panel for tabs
        local tabsFrame = Instance.new('Frame')
        tabsFrame.Name = 'TabsFrame'
        tabsFrame.BackgroundColor3 = COLOR_SURFACE_DARK
        tabsFrame.BorderSizePixel  = 0
        tabsFrame.Size = UDim2.new(0, 140, 1, 0)
        tabsFrame.Parent = container
        Instance.new('UICorner', tabsFrame).CornerRadius = UDim.new(0, 14)
        local tabsLayout = Instance.new('UIListLayout', tabsFrame)
        tabsLayout.FillDirection = Enum.FillDirection.Vertical
        tabsLayout.SortOrder     = Enum.SortOrder.LayoutOrder
        tabsLayout.Padding       = UDim.new(0, 4)
        -- right panel for content
        local contentFrame = Instance.new('Frame')
        contentFrame.Name = 'ContentFrame'
        contentFrame.BackgroundColor3 = COLOR_SURFACE
        contentFrame.BorderSizePixel  = 0
        contentFrame.Size = UDim2.new(1, -160, 1, 0)
        contentFrame.Position = UDim2.new(0, 150, 0, 0)
        contentFrame.Parent = container
        Instance.new('UICorner', contentFrame).CornerRadius = UDim.new(0, 14)
        -- hold current tab
        window._tabs = {}
        window._selectedTab = nil
        window._sg = sg
        window._card = card
        window._tabsFrame = tabsFrame
        window._contentFrame = contentFrame
        window._open = true
        -- Toggling methods
        function window:Toggle()
            self._open = not self._open
            sg.Enabled = self._open
        end
        function window:GetOpen()
            return self._open
        end
        function window:SetOpen(b)
            self._open = b
            sg.Enabled = b
        end
        function window:ToggleUI()
            self:Toggle()
        end
        function window:ToggleMain()
            self:Toggle()
        end
        -- Drag support
        DragGroup:register(card, topBar)
        -- Keybind support
        if opts.Keybind and typeof(opts.Keybind) == 'EnumItem' then
            UIS.InputBegan:Connect(function(input, gpe)
                if not gpe and input.KeyCode == opts.Keybind then
                    window:Toggle()
                end
            end)
        end
        -- TabGroup object
        local TabGroup = {}
        function TabGroup:Tab(info)
            info = info or {}
            local tab = {}
            tab._sections = {}
            tab._title = info.Title or 'Tab'
            -- create tab button in sidebar
            local btn = Instance.new('TextButton')
            btn.Name               = 'TabButton_' .. tab._title
            btn.Text               = tab._title
            btn.Font               = Enum.Font.GothamBold
            btn.TextSize           = 14
            btn.TextColor3         = COLOR_TEXT
            btn.AutoButtonColor    = false
            btn.BackgroundColor3   = COLOR_SURFACE
            btn.Size               = UDim2.new(1, -8, 0, 36)
            btn.Position           = UDim2.new(0, 4, 0, 0)
            Instance.new('UICorner', btn).CornerRadius = UDim.new(0, 10)
            -- highlight line
            local highlight = Instance.new('Frame')
            highlight.Name             = 'Highlight'
            highlight.Parent           = btn
            highlight.BackgroundColor3 = COLOR_TEAL_ON
            highlight.BorderSizePixel  = 0
            highlight.Size             = UDim2.new(0, 4, 1, 0)
            highlight.Position         = UDim2.new(0, 0, 0, 0)
            highlight.Visible          = false
            highlight.ZIndex           = btn.ZIndex + 1
            btn.Parent = tabsFrame
            -- create content container for this tab
            local tabContent = Instance.new('ScrollingFrame')
            tabContent.Name               = 'TabContent_' .. tab._title
            tabContent.BackgroundTransparency = 1
            tabContent.BorderSizePixel    = 0
            tabContent.Position           = UDim2.new(0, 10, 0, 10)
            tabContent.Size               = UDim2.new(1, -20, 1, -20)
            tabContent.CanvasSize         = UDim2.new(0, 0, 0, 0)
            tabContent.ScrollBarThickness = 4
            tabContent.ScrollingDirection = Enum.ScrollingDirection.Y
            tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
            tabContent.Visible            = false
            tabContent.Parent             = contentFrame
            local listLayout = Instance.new('UIListLayout', tabContent)
            listLayout.Padding   = UDim.new(0, 6)
            listLayout.SortOrder = Enum.SortOrder.LayoutOrder
            -- show/hide logic
            local function selectTab()
                -- hide previous
                if window._selectedTab and window._selectedTab._content then
                    window._selectedTab._content.Visible = false
                    window._selectedTab._btn.BackgroundColor3 = COLOR_SURFACE
                    window._selectedTab._btn.Highlight.Visible = false
                end
                -- set this
                window._selectedTab = tab
                tabContent.Visible  = true
                btn.BackgroundColor3= COLOR_SURFACE_DARK
                highlight.Visible   = true
            end
            btn.MouseButton1Click:Connect(function()
                selectTab()
            end)
            -- if first tab, select by default
            table.insert(window._tabs, tab)
            if #window._tabs == 1 then
                selectTab()
            end
            -- store references on tab object
            tab._btn     = btn
            tab._content = tabContent
            -- Section creation
            function tab:Section(secInfo)
                secInfo = secInfo or {}
                local section = {}
                section._controls = {}
                -- section frame
                local sFrame = Instance.new('Frame')
                sFrame.Name       = 'Section_' .. (secInfo.Title or '')
                sFrame.BackgroundColor3 = COLOR_SURFACE_DARK
                sFrame.BorderSizePixel  = 0
                sFrame.Size       = UDim2.new(1, 0, 0, 0)
                sFrame.AutomaticSize = Enum.AutomaticSize.Y
                sFrame.Parent     = tabContent
                Instance.new('UICorner', sFrame).CornerRadius = UDim.new(0, 12)
                local sLayout = Instance.new('UIListLayout', sFrame)
                sLayout.FillDirection = Enum.FillDirection.Vertical
                sLayout.SortOrder     = Enum.SortOrder.LayoutOrder
                sLayout.Padding       = UDim.new(0, 4)
                -- title label
                if secInfo.Title and secInfo.Title ~= '' then
                    local titleLbl = Instance.new('TextLabel')
                    titleLbl.Name               = 'SectionTitle'
                    titleLbl.Text               = tostring(secInfo.Title)
                    titleLbl.Font               = Enum.Font.GothamSemibold
                    titleLbl.TextSize           = 16
                    titleLbl.TextColor3         = COLOR_TEAL_ON
                    titleLbl.BackgroundTransparency = 1
                    titleLbl.Position           = UDim2.new(0, 8, 0, 6)
                    titleLbl.Size               = UDim2.new(1, -16, 0, 20)
                    titleLbl.TextXAlignment     = Enum.TextXAlignment.Left
                    titleLbl.Parent             = sFrame
                end
                -- controls container
                local cFrame = Instance.new('Frame')
                cFrame.Name           = 'Controls'
                cFrame.BackgroundTransparency = 1
                cFrame.Size           = UDim2.new(1, -16, 0, 0)
                cFrame.Position       = UDim2.new(0, 8, 0, 0)
                cFrame.AutomaticSize  = Enum.AutomaticSize.Y
                cFrame.Parent         = sFrame
                local cLayout = Instance.new('UIListLayout', cFrame)
                cLayout.FillDirection = Enum.FillDirection.Vertical
                cLayout.SortOrder     = Enum.SortOrder.LayoutOrder
                cLayout.Padding       = UDim.new(0, 6)
                -- Control creators
                function section:Paragraph(info)
                    info = info or {}
                    local row = Instance.new('Frame')
                    row.BackgroundColor3 = COLOR_SURFACE
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 0)
                    row.AutomaticSize    = Enum.AutomaticSize.Y
                    Instance.new('UICorner', row).CornerRadius = UDim.new(0, 10)
                    row.Parent           = cFrame
                    local txt = Instance.new('TextLabel')
                    txt.BackgroundTransparency = 1
                    txt.Font               = Enum.Font.Gotham
                    txt.TextWrapped        = true
                    txt.TextColor3         = COLOR_TEXT_MUTED
                    txt.TextSize           = 14
                    txt.TextXAlignment     = Enum.TextXAlignment.Left
                    txt.TextYAlignment     = Enum.TextYAlignment.Top
                    txt.Position           = UDim2.new(0, 8, 0, 6)
                    txt.Size               = UDim2.new(1, -16, 0, 0)
                    txt.AutomaticSize      = Enum.AutomaticSize.Y
                    local fullText = ''
                    if info.Title and info.Title ~= '' then
                        fullText = info.Title
                    end
                    if info.Desc and info.Desc ~= '' then
                        if fullText ~= '' then fullText = fullText .. '\n' .. info.Desc else fullText = info.Desc end
                    end
                    txt.Text = fullText
                    txt.Parent = row
                    return {}
                end
                function section:Button(info)
                    info = info or {}
                    local row = Instance.new('TextButton')
                    row.BackgroundColor3 = COLOR_SURFACE
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    row.AutoButtonColor  = true
                    row.Text             = ''
                    Instance.new('UICorner', row).CornerRadius = UDim.new(0, 10)
                    row.Parent           = cFrame
                    local lbl = Instance.new('TextLabel')
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or 'Button')
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT
                    lbl.Size               = UDim2.new(1, -16, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent = row
                    row.MouseButton1Click:Connect(function()
                        if type(info.Callback) == 'function' then
                            task.spawn(function()
                                info.Callback()
                            end)
                        end
                    end)
                    return {}
                end
                function section:Toggle(info)
                    info = info or {}
                    local row = Instance.new('Frame')
                    row.BackgroundColor3 = COLOR_SURFACE
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    Instance.new('UICorner', row).CornerRadius = UDim.new(0, 10)
                    row.Parent           = cFrame
                    local lbl = Instance.new('TextLabel')
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or 'Toggle')
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT
                    lbl.Size               = UDim2.new(1, -60, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent = row
                    -- toggle button
                    local tgBtn = Instance.new('Frame')
                    tgBtn.Name               = 'Switch'
                    tgBtn.Size               = UDim2.fromOffset(40, 20)
                    tgBtn.Position           = UDim2.new(1, -48, 0.5, -10)
                    tgBtn.BackgroundColor3   = COLOR_SURFACE_DARK
                    tgBtn.BorderSizePixel    = 0
                    Instance.new('UICorner', tgBtn).CornerRadius = UDim.new(0, 10)
                    local knob = Instance.new('Frame')
                    knob.Name                 = 'Knob'
                    knob.Size                 = UDim2.fromOffset(18, 18)
                    knob.Position             = UDim2.new(0, 1, 0, 1)
                    knob.BackgroundColor3     = COLOR_TEXT_MUTED
                    knob.BorderSizePixel      = 0
                    Instance.new('UICorner', knob).CornerRadius = UDim.new(1, 0)
                    knob.Parent = tgBtn
                    tgBtn.Parent = row
                    local state = (info.Default == true)
                    local function updateVisual()
                        if state then
                            tgBtn.BackgroundColor3 = COLOR_TEAL_ON
                            knob.Position = UDim2.new(1, -19, 0, 1)
                            knob.BackgroundColor3 = COLOR_SURFACE
                        else
                            tgBtn.BackgroundColor3 = COLOR_SURFACE_DARK
                            knob.Position = UDim2.new(0, 1, 0, 1)
                            knob.BackgroundColor3 = COLOR_TEXT_MUTED
                        end
                    end
                    updateVisual()
                    row.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            state = not state
                            updateVisual()
                            if type(info.Callback) == 'function' then
                                task.spawn(function()
                                    info.Callback(state)
                                end)
                            end
                        end
                    end)
                    return {}
                end
                function section:Dropdown(info)
                    info = info or {}
                    local row = Instance.new('Frame')
                    row.BackgroundColor3 = COLOR_SURFACE
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    Instance.new('UICorner', row).CornerRadius = UDim.new(0, 10)
                    row.Parent           = cFrame
                    local lbl = Instance.new('TextLabel')
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or 'Select')
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT
                    lbl.Size               = UDim2.new(1, -60, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    -- selected display
                    local selLbl = Instance.new('TextLabel')
                    selLbl.BackgroundTransparency = 1
                    selLbl.Text               = ''
                    selLbl.Font               = Enum.Font.Gotham
                    selLbl.TextSize           = 13
                    selLbl.TextColor3         = COLOR_TEXT_MUTED
                    selLbl.Size               = UDim2.new(1, -60, 1, 0)
                    selLbl.Position           = UDim2.new(0, 8, 0, 0)
                    selLbl.TextXAlignment     = Enum.TextXAlignment.Right
                    selLbl.Parent             = row
                    -- dropdown container
                    local listFrame = Instance.new('Frame')
                    listFrame.Name            = 'DropList'
                    listFrame.Parent          = cFrame
                    listFrame.BackgroundColor3= COLOR_SURFACE_DARK
                    listFrame.BorderSizePixel = 0
                    listFrame.Size            = UDim2.new(1, -16, 0, 0)
                    listFrame.Position        = UDim2.new(0, 8, 0, 0)
                    listFrame.Visible         = false
                    Instance.new('UICorner', listFrame).CornerRadius = UDim.new(0, 8)
                    local listLayout = Instance.new('UIListLayout', listFrame)
                    listLayout.FillDirection = Enum.FillDirection.Vertical
                    listLayout.SortOrder     = Enum.SortOrder.LayoutOrder
                    listLayout.Padding       = UDim.new(0, 4)
                    -- scroll for list if too long
                    local scroller = Instance.new('ScrollingFrame')
                    scroller.Parent           = listFrame
                    scroller.BackgroundTransparency = 1
                    scroller.BorderSizePixel  = 0
                    scroller.Size             = UDim2.new(1, 0, 0, 0)
                    scroller.Position         = UDim2.new(0, 0, 0, 0)
                    scroller.AutomaticSize    = Enum.AutomaticSize.Y
                    scroller.ScrollBarThickness = 4
                    scroller.ScrollingDirection = Enum.ScrollingDirection.Y
                    scroller.CanvasSize       = UDim2.new(0, 0, 0, 0)
                    local scLayout = Instance.new('UIListLayout', scroller)
                    scLayout.FillDirection   = Enum.FillDirection.Vertical
                    scLayout.SortOrder       = Enum.SortOrder.LayoutOrder
                    scLayout.Padding         = UDim.new(0, 2)
                    -- selection state
                    local selected = {}
                    local function updateSelectedLabel()
                        if info.Multi then
                            local names = {}
                            for _, v in ipairs(selected) do
                                table.insert(names, tostring(v))
                            end
                            selLbl.Text = table.concat(names, ', ')
                        else
                            selLbl.Text = tostring(selected[1] or '')
                        end
                    end
                    -- populate options
                    local opts = info.Options or {}
                    -- convert default to table
                    local defaults = {}
                    if info.Default then
                        if type(info.Default) == 'table' then
                            defaults = info.Default
                        else
                            defaults = { info.Default }
                        end
                    end
                    for _, opt in ipairs(opts) do
                        local oBtn = Instance.new('TextButton')
                        oBtn.Name              = 'Option_' .. tostring(opt)
                        oBtn.Text              = tostring(opt)
                        oBtn.Font              = Enum.Font.Gotham
                        oBtn.TextSize          = 14
                        oBtn.TextColor3        = COLOR_TEXT
                        oBtn.AutoButtonColor   = false
                        oBtn.BackgroundColor3  = COLOR_SURFACE
                        oBtn.BorderSizePixel   = 0
                        oBtn.Size              = UDim2.new(1, -4, 0, 28)
                        Instance.new('UICorner', oBtn).CornerRadius = UDim.new(0, 6)
                        oBtn.Parent            = scroller
                        local selectedThis = false
                        for _, d in ipairs(defaults) do
                            if d == opt then
                                selectedThis = true
                                break
                            end
                        end
                        if selectedThis then
                            if info.Multi then
                                table.insert(selected, opt)
                            else
                                selected = { opt }
                            end
                            oBtn.BackgroundColor3 = COLOR_TEAL_ON
                        end
                        oBtn.MouseButton1Click:Connect(function()
                            if info.Multi then
                                local found = false
                                for i, v in ipairs(selected) do
                                    if v == opt then
                                        found = true
                                        table.remove(selected, i)
                                        break
                                    end
                                end
                                if not found then
                                    table.insert(selected, opt)
                                end
                                -- update colors
                                for _, child in ipairs(scroller:GetChildren()) do
                                    if child:IsA('TextButton') then
                                        if table.find(selected, child.Text) then
                                            child.BackgroundColor3 = COLOR_TEAL_ON
                                        else
                                            child.BackgroundColor3 = COLOR_SURFACE
                                        end
                                    end
                                end
                            else
                                selected = { opt }
                                -- reset color
                                for _, child in ipairs(scroller:GetChildren()) do
                                    if child:IsA('TextButton') then
                                        child.BackgroundColor3 = COLOR_SURFACE
                                    end
                                end
                                oBtn.BackgroundColor3 = COLOR_TEAL_ON
                                listFrame.Visible = false
                            end
                            updateSelectedLabel()
                            if type(info.Callback) == 'function' then
                                -- pass multi-state map or list similar to MacLib
                                local out
                                if info.Multi then
                                    -- return map { opt=true, ... }
                                    out = {}
                                    for _, v in ipairs(selected) do out[v] = true end
                                else
                                    out = selected[1]
                                end
                                task.spawn(function()
                                    info.Callback(out)
                                end)
                            end
                        end)
                    end
                    updateSelectedLabel()
                    -- open/close dropdown
                    row.InputBegan:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            listFrame.Visible = not listFrame.Visible
                            -- reposition dropdown under row
                            listFrame.Parent = cFrame
                        end
                    end)
                    -- adjust drop size after created options
                    task.defer(function()
                        scroller.Size = UDim2.new(1, 0, 0, math.min(#opts * 30, 120))
                        listFrame.Size = UDim2.new(1, 0, 0, scroller.Size.Y.Offset + 8)
                    end)
                    return {}
                end
                function section:Input(info)
                    info = info or {}
                    local row = Instance.new('Frame')
                    row.BackgroundColor3 = COLOR_SURFACE
                    row.BorderSizePixel  = 0
                    row.Size             = UDim2.new(1, 0, 0, 36)
                    Instance.new('UICorner', row).CornerRadius = UDim.new(0, 10)
                    row.Parent           = cFrame
                    local lbl = Instance.new('TextLabel')
                    lbl.BackgroundTransparency = 1
                    lbl.Text               = tostring(info.Title or 'Input')
                    lbl.Font               = Enum.Font.GothamSemibold
                    lbl.TextSize           = 14
                    lbl.TextColor3         = COLOR_TEXT
                    lbl.Size               = UDim2.new(0.5, -8, 1, 0)
                    lbl.Position           = UDim2.new(0, 8, 0, 0)
                    lbl.TextXAlignment     = Enum.TextXAlignment.Left
                    lbl.Parent             = row
                    local tb = Instance.new('TextBox')
                    tb.BackgroundColor3    = COLOR_SURFACE_DARK
                    tb.BorderSizePixel     = 0
                    tb.Size                = UDim2.new(0.5, -12, 1, -10)
                    tb.Position            = UDim2.new(0.5, 4, 0, 5)
                    tb.Font                = Enum.Font.Gotham
                    tb.TextSize            = 14
                    tb.TextColor3          = COLOR_TEXT
                    tb.PlaceholderText     = tostring(info.Placeholder or '')
                    tb.Text                = tostring(info.Default or '')
                    Instance.new('UICorner', tb).CornerRadius = UDim.new(0, 6)
                    tb.Parent             = row
                    tb.FocusLost:Connect(function(enterPressed)
                        local val = tb.Text
                        if type(info.Callback) == 'function' then
                            task.spawn(function()
                                info.Callback(val)
                            end)
                        end
                    end)
                    return {}
                end
                return section
            end
            return tab
        end
        window._tabGroup = TabGroup
        function window:TabGroup()
            return TabGroup
        end
        -- assign global for toggle detection
        _G.__MAC_WINDOW = window
        return window
    end
end

return MacLib
